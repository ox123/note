1. SEDA （Stage Event Driven Architecture） 一个请求过程分成若干个stage（阶段）

### 功能模块图

<img src="assets/image-20201026185629114.png" alt="image-20201026185629114" style="zoom:150%;" />

### netty逻辑架构图

- 网络通信层

  - 网络通信层的核心组件包含BootStrap、ServerBootStrap、Channel三个组件。

  >Bootstrap

  - 它主要负责整个 Netty 程序的启动、初始化、服务器连接等过程，它相当于一条主线，串联了 Netty 的其他核心组件。
  - 一个为用于客户端引导的 Bootstrap，另一个为用于服务端引导的 ServerBootStrap，它们都继承自抽象类 AbstractBootstrap。

  > Channel,网络通信的载体,Channel提供了基本的 API 用于网络 I/O 操作，如 register、bind、connect、read、write、flush 等。Netty 自己实现的 Channel 是以 JDK NIO Channel 为基础的，相比较于 JDK NIO，Netty 的 Channel 提供了更高层次的抽象，同时屏蔽了底层 Socket 的复杂性，赋予了 Channel 更加强大的功能，你在使用 Netty 时基本不需要再与 Java Socket 类直接打交道。

  - NioServerSocketChannel 异步 TCP 服务端。

  - NioSocketChannel 异步 TCP 客户端。
  - Channel 最常见的状态所对应的事件回调。

  ![image-20201026202418855](assets/image-20201026202418855.png)

- 事件调度层

  - 事件调度层的职责是通过 Reactor 线程模型对各类事件进行聚合处理，通过 Selector 主循环线程集成多种事件（ I/O 事件、信号事件、定时事件等），实际的业务处理逻辑是交由服务编排层中相关的 Handler 完成。

  - **事件调度层的核心组件包括 EventLoopGroup、EventLoop。**

    - 一个 EventLoopGroup 往往包含一个或者多个 EventLoop。EventLoop 用于处理 Channel 生命周期内的所有 I/O 事件，如 accept、connect、read、write 等 I/O 事件。
    - EventLoop 同一时间会与一个线程绑定，每个 EventLoop 负责处理多个 Channel。
    - 每新建一个 Channel，EventLoopGroup 会选择一个 EventLoop 与其绑定。该 Channel 在生命周期内都可以对 EventLoop 进行多次绑定和解绑。

    ![image-20201026204421395](assets/image-20201026204421395.png)

  - EventLoopGroup 本质是一个**线程池，主要负责接收 I/O 请求，并分配线程执行处理请求**，是 Netty Reactor 线程模型的具体实现方式

    ![image-20201026204505687](assets/image-20201026204505687.png)

  - Reactor三种线程模型

    1. **单线程模型**：EventLoopGroup 只包含一个 EventLoop，Boss 和 Worker 使用同一个EventLoopGroup；

    2. **多线程模型**：EventLoopGroup 包含多个 EventLoop，Boss 和 Worker 使用同一个EventLoopGroup；

    3. **主从多线程模型**：EventLoopGroup 包含多个 EventLoop，Boss 是主 Reactor，Worker 是从 Reactor，它们分别使用不同的 EventLoopGroup，主 Reactor 负责新的网络连接 Channel 创建，然后把 Channel 注册到从 Reactor。

- 服务编排层

![image-20201026195805734](assets/image-20201026195805734.png)