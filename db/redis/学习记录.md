### redis全景图

<img src="assets/image-20200823122847275.png" alt="image-20200823122847275" style="zoom:50%;" />

- 应用维度

  - 应用场景驱动
  - 典型案例驱动

- 问题画像图

  <img src="assets/image-20200823123231761.png" alt="image-20200823123231761" style="zoom:50%;" />

- simple kv设计

  <img src="assets/image-20200823124913530.png" alt="image-20200823124913530" style="zoom: 33%;" />![image-20200823124936136](assets/image-20200823124936136.png)

  <img src="assets/image-20200823124913530.png" alt="image-20200823124913530" style="zoom: 33%;" />![image-20200823124936136](assets/image-20200823124936136.png)




### redis 类型与数据结构对应关系

<img src="assets/image-20200914221809451.png" alt="image-20200914221809451" style="zoom:50%;" />

### Redis 基本IO模型

<img src="assets/image-20200920232759073.png" alt="image-20200920232759073" style="zoom: 50%;" />![image-20200920232845247](assets/image-20200920232845247.png)

<img src="assets/image-20200920233050948.png" alt="image-20200920233050948" style="zoom:50%;" />

- **selectepoll提供了基于事件的回调机制，对于不同事件的发生，调用相应的处理函数**

### 数据持久化

**AOF**

<img src="assets/image-20200920233557291.png" alt="image-20200920233557291" style="zoom:50%;" />

后写日志两大优点

1. 先让系统执行以下命令，如果成功则写入文件，如果失败，直接抛出异常。
2. 在命令执行后才记录日志，不会阻塞当前的写操作。

> 因为这个机制，在使用的时候可能时候系统的性能瓶颈，如果写入磁盘较慢，可能给下一个操作带来阻塞风险，AOF日志也是在主线程中执行的，如果把日志文件写入磁盘时，磁盘写压力大，就会导致写盘很慢，进而导致后续的操作也无法执行。
>
> 注意AOF文件过大带来的性能影响。



针对上述的问题，AOF增加配置项appendfsync配置项解决。

<img src="assets/image-20200920234430045.png" alt="image-20200920234430045" style="zoom:50%;" />



**文件过大带来的性能问题**

1. 重写AOF日志文件
2. 