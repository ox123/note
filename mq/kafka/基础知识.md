- 延时操作使用时间轮方式
- Timer， DelayQueue延迟实现使用方式与区别 时间复杂度o(nlogn) 不能满足高性能要求。
- scala实现：```TimingWheel```

- 延时操作管理器：```DelayedOperationPurgatory```

- ```ExpiredOperationReaper``` 时间轮得轮转由此实现

- 客户端在请求写入消息到收到响应结果得过程中与延时生产操作相关得细节

  ![image-20200514233254322](assets/image-20200514233254322.png)



### 基本概念

<img src="assets/image-20200923212509314.png" alt="image-20200923212509314"  />

**主题分区与副本的关系**

- 第一层是主题层，每个主题可以配置 M 个分区，而每个分区又可以配置 N 个副本。
- 第二层是分区层，每个分区的 N 个副本中只能有一个充当领导者角色，对外提供服务；其他 N-1 个副本是追随者副本，只是提供数据冗余之用。
- 第三层是消息层，分区中包含若干条消息，每条消息的位移从 0 开始，依次递增。
- 最后，客户端程序只能与分区的领导者副本进行交互。

### kafka设计初衷

- 提供一套 API 实现生产者和消费者；
- 降低网络传输和磁盘存储开销；
- 实现高伸缩性架构。

### kafka connect生态圈

![image-20200923221713562](assets/image-20200923221713562.png)

